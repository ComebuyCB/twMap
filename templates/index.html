<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut Icon" type="image/x-icon" href="/static/common/img/logo/Logo@3x.png">
  <title></title>

  <!-- google fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- core -->
  <script src="/static/core/jquery-3.5.1/jquery-3.5.1.min.js"></script>
  <link href="/static/core/bootstrap-5.1.3/css/bootstrap-custom.css" rel="stylesheet">
  <script src="/static/core/bootstrap-5.1.3/js/bootstrap.bundle.min.js"></script>
  
  <!-- main -->
  <link href="/static/common/css/main.css" rel="stylesheet">
  <script src="/static/common/js/main.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <script src="https://unpkg.co/gsap@3/dist/gsap.min.js"></script>
  <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->

  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <!-- <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script> -->

  <style>
    #detail-charts { width: 400px; }
    hr { margin-top: .5rem; margin-bottom: .5rem; }
    @media( max-width: 420px ){
      #detail-charts { width: 300px; }
    }
  </style>
</head>
<body>
  <div id="wrap">
    <main class="py-0">
      <button id="backLv" class="btn btn-light pos-f loc-7" style="z-index: 10; display: none;">←</button>

      <div class="nav flex-column nav-pills pos-f loc-7" style="z-index: 10; top: 50px;" role="tablist">
        <button id="showPPColor" class="btn btn-primary nav-link active" data-bs-toggle="pill" type="button" role="tab" onclick="changeThemeColor()">議員好感度黨籍比例</button>
        <button id="showSFColor" class="btn btn-primary nav-link" data-bs-toggle="pill" type="button" role="tab" onclick="changeThemeColor()">市長施政滿意度</button>
      </div>

      <div class="d-flex flex-column pos-f loc-9" style="z-index: 10;">
        <button id="zoomIn" class="btn btn-success py-1 fs-5">+</button>
        <button id="zoomOut" class="btn btn-success py-1 fs-5">-</button>
      </div> 
      
      <div id="map">
        <div id="svgBox" style="transform: translate(0px,0px) scale(1)">
          <svg id="svg" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
      </div>

      <div id="detail-hover" class="card p-1 pos-f" style="display: none; pointer-events: none;">
        <h6 id="detail-county"></h6>
        <small id="detail-town"></small>
      </div>

      <div id="detail-click" class="card p-3 pos-f loc-3">
        <h6 id="detail-mp"></h6>
        <div id="detail-charts" style="display: none">
          <div>選區最受歡迎議員前三名</div>
          <div id="detail-chart1"></div>
          <hr>
          <div>議員好感度黨籍比例</div>
          <div id="detail-chart2"></div>
          <hr>
          <div>市長施政滿意度</div>
          <div id="detail-chart3"></div>
          <hr>
          <div>政黨傾向</div>
          <div id="detail-chart4"></div>
        </div>
      </div>
    </main>
  </div>
  
  <script>
    var ww = window.innerWidth
    var wh = window.innerHeight
    var onDrag = false
    var onZoom = false
    var scaleValue = 1
    var scaleAmp = 2
    var blueColor = d3.scale.linear().domain([40,100]).range(['#CDE7FB','#0F468C'])
    var greenColor = d3.scale.linear().domain([40,100]).range(['#C1F7E5','#186839'])
    var ppColor = d3.scale.linear().domain([-30,30]).range(['#05A5F5','#6BDA45'])
    var sfColor = d3.scale.linear().domain([-30,30]).range(['#FF0000','#00EE00'])
    var data

    interact('#svgBox')
      // .gesturable({
      //   modifiers: [
      //     interact.modifiers.restrictRect({
      //       restriction: 'parent',
      //       endOnly: true
      //     })
      //   ],
      //   listeners: {
      //     start (event) {

      //     },
      //     move (event) {
      //       let nS = scaleValue * event.scale

      //       nS = nS > 24 ? 24 : nS
      //       nS = nS < 1 ? 1 : nS
            
      //       $('#detail-percent').text(nS)
      //       $(event.target).css('transform',`scale(${nS})`)
      //       dragMoveListener(event)
      //     },
      //     end (event) {
      //       scaleValue = scaleValue * event.scale
      //     }
      //   }
      // })
      .draggable({
        inertia: true,
        modifiers: [
          interact.modifiers.restrictRect({
            restriction: 'parent',
            endOnly: true
          })
        ],
        listeners: {
          start (){
            onDrag = true
          },
          move (event) {
            dragMoveListener(event)
          },
          end (event) {
            let st = setTimeout(()=>{
              onDrag = false
              clearTimeout(st)
            }, 0)
          }
        }
      })
      
      function dragMoveListener(event) {
        let trans = getXYS( event.target )
        let x = (parseFloat(trans.x) || 0) + event.dx
        let y = (parseFloat(trans.y) || 0) + event.dy

        $(event.target).css('transform', `translate(${x}px, ${y}px) scale(${trans.s})`)
      }

    function getXYS( elem ){
      let style = window.getComputedStyle( elem )
      let matrix = new WebKitCSSMatrix(style.transform)
      let {a,b,c,d,e,f} = matrix
      // console.log(a,b,c,d,e,f)
      return {x: e, y: f, s: a}
    }

    // 讓d3抓svg，並寫入寬高
    $('#svgBox').css({ width: ww, height: wh})
    $('#svg').attr('width', ww).attr('height', wh).attr('viewBox', `0 0 ${ww} ${wh}`)

    // 地圖網址: https://data.gov.tw/dataset/7441、https://data.gov.tw/dataset/7442
    // 地圖轉換: https://mapshaper.org/
    /* 步驟: 
     *  1.[地圖網址] 按SHP下載
     *  2.[轉換網址] 上傳壓縮檔
     *    2-1.Simplify 簡化線圖
     *    2-2.Export GeoJSON
     **/

    $.get( '/static/common/json/TOWN2.json', ( townData )=>{
      $.get( '/static/common/json/COUNTY5.json', ( countyData )=>{
        $.get( '/static/common/json/survey.json', ( surveyData )=>{
          townData['mapSize'] = 'town'
          countyData['mapSize'] = 'county'

          // 將數據 % 轉為 純數字
          surveyData = surveyData.map( (obj) => {
            $.each( obj, (key, val) => {
              if ( val.indexOf('%') !== -1 ){
                obj[key] = +val.replace('%','')
              } else if ( key === '縣市' || key === '行政區' || key === '第一名議員' || key === '第二名議員' || key === '第三名議員' ) {
                obj[key] = val
              } else if ( val === '' ) {
                obj[key] = 0
              } else {
                obj[key] = val
              }
            })
            return obj
          })

          // 鄉鎮 塞入數據
          townData.features.forEach( (obj) => {
            surveyData.forEach( (svObj) => {
              if ( obj.properties.TOWNNAME && ( svObj['縣市'] === obj.properties.COUNTYNAME && svObj['行政區'] === obj.properties.TOWNNAME ) ){
                obj['mp'] = svObj
                return true
              }
            })
          })

          // 縣市 塞入數據
          countyData.features.forEach( (obj) => {
            surveyData.forEach( (svObj) => {
              if ( svObj['縣市'] === obj.properties.COUNTYNAME && svObj['行政區'] === '總和' ){
                obj['mp'] = svObj
                return true
              }
            })
          })

          // countyData = data_polygon_edit( countyData, (item)=>{ item.reverse() })

          let allData = JSON.parse(JSON.stringify(townData))
          allData['mapSize'] = 'all'
          allData.features = [...townData.features, ...countyData.features]


          function getGeo_DeleteOutOfBoundary( geo, boundary ){
            let {left=-180, right=180, top=90, bottom=-90} = boundary
            
            let coord = geo.coordinates
            if ( geo.type === 'MultiPolygon' ){
              $.each( coord, (cIdx, cItem) => {
                $.each( cItem, (iIdx, iItem) => {
                  cItem[iIdx] = iItem.filter( (item, idx) => {
                    return (
                      item[0] > left &&
                      item[0] < right &&
                      item[1] < top &&
                      item[1] > bottom
                    )
                  })
                })
              })
              // 過濾空陣列
              $.each( coord, (cIdx, cItem) => { 
                coord[cIdx] = cItem.filter( (item, idx) => {
                  return item[0]
                })
              })
            } 
            else if ( geo.type === 'Polygon' ) {
              $.each( coord, (cIdx, cItem) => {
                coord[cIdx] = cItem.filter( (item, idx) => {
                  return (
                    item[0] > left &&
                    item[0] < right &&
                    item[1] < top &&
                    item[1] > bottom
                  )
                })
              })
            }

            return geo
          }

          $.each( allData.features, (idx, obj) => {
            let prop = obj.properties
            let geo = obj.geometry
            let coord = obj.geometry.coordinates
            
            switch( prop.COUNTYID ){
              case 'E': // 高雄市
                // 刪除離島
                var boundary = {
                  left: 120.0,
                  bottom: 22.2
                }

                // COUNTY & TOWN (旗津區)
                if ( prop.TOWNID === undefined || prop.TOWNID === 'E10' ){
                  geo = getGeo_DeleteOutOfBoundary( geo, boundary)
                }
              break;

              case 'C': // 基隆市
                // 刪除離島
                var boundary = {
                  right: 121.9,
                  top: 25.2
                }

                // COUNTY & TOWN (中正區)
                if ( prop.TOWNID === undefined || prop.TOWNID === 'C01' ){
                  geo = getGeo_DeleteOutOfBoundary( geo, boundary)
                }
              break;

              case 'G': // 宜蘭縣
                // 刪除離島
                var boundary = {
                  right: 122.1,
                  top: 25.1
                }

                // COUNTY & TOWN (頭城鎮)
                if ( prop.TOWNID === undefined || prop.TOWNID === 'G02' ){
                  geo = getGeo_DeleteOutOfBoundary( geo, boundary)
                }
              break;

              case 'Z': // 連江縣
                // 偏移 (連江縣)
                var loc_W = [0.3, -0.7]
                geo = data_polygon_edit( geo, (item)=>{
                  $.each( item, (idx,val)=>{
                    val[0] += loc_W[0]
                    val[1] += loc_W[1]
                  })
                })
              break;

              case 'W': // 金門縣
                // 偏移 (金門縣)
                var loc_W = [1.1, 0]
                geo = data_polygon_edit( geo, (item)=>{
                  $.each( item, (idx,val)=>{
                    val[0] += loc_W[0]
                    val[1] += loc_W[1]
                  })
                })

                // 偏移 (烏坵鄉)
                var loc_W06 = [-0.65, -0.35]

                // COUNTY
                if ( prop.TOWNID === undefined ){
                  if ( geo.type === 'MultiPolygon' ){
                    $.each( coord, (cIdx, cItem) => {
                      if ( cIdx == coord.length-1 || cIdx == coord.length-2 ){
                        $.each( cItem, (idx2, ele2) => {
                          $.each( ele2, (idx3, ele3) => {
                            ele3[0] += loc_W06[0]
                            ele3[1] += loc_W06[1]
                          })
                        })
                      }
                    })
                  } else if ( geo.type === 'Polygon' ) {
                    $.each( coord, (cIdx, cItem) => {
                      if ( cIdx == coord.length-1 || cIdx == coord.length-2 ){
                        $.each( cItem, (idx2, ele2) => {
                          ele2[0] += loc_W06[0]
                          ele2[1] += loc_W06[1]
                        })
                      }
                    })
                  }
                }

                // TOwN (烏坵鄉)
                if ( prop.TOWNID === 'W06' ){
                  geo = data_polygon_edit( geo, (item)=>{
                    $.each( item, (idx, ele)=>{
                      ele[0] += loc_W06[0]
                      ele[1] += loc_W06[1]
                    })
                  })
                }
                break;
            }
          })

          // 額外處理json檔，因為原始檔案陣列是反轉的，所以將它校正。
          data = data_polygon_edit( allData, (item)=>{ item.reverse() })

          create_D3GeoMap('#svg', data)
        })
      })
    })


    /**
     * @param {object} data 給整個json資料 或 資料裡特定的 geometry
     * @param {function} callback(item) 處理這層座標: [[122,23][122,24]...]
     * @param {boolean} lvUpper 如果為 true, 處理上層座標: [[[122,23][122,24]...]...]
     **/
    function data_polygon_edit( data, callback ){
      /* 
        data: {
          features: [
            {
              geometry: {
                type: "Polygon",
                coordinates: [[[0,0][1,1]]], // 共3層，item為下一層: [[0,0][1,1]]
              }
            },
            {
              geometry: {
                type: "MultiPolygon",
                coordinates: [[[[0,0][1,1]]]], // 共4層，item為下二層: [[0,0][1,1]]
              }
            }
          ]
        }
      */
      if ( data.features ){ // 給整個json
        $.each( data.features, (idx, obj) => {
          forGeoCoord(obj.geometry)
        })
      } else if ( data.coordinates ){ // 給指定geo
        forGeoCoord(data)
      }

      function forGeoCoord(geo){
        if ( geo.type === 'MultiPolygon' ){
          $.each( geo.coordinates, (cIdx, cItem) => {
            $.each( cItem, (iIdx, item) => {
              doItems( item )
            })
          })
        } else if ( geo.type === 'Polygon' ) {
          $.each( geo.coordinates, (cIdx, cItem) => {
            doItems( cItem )
          })
        }
      }

      function doItems( item ){
        callback( item )
      }
      
      return data
    }


    function create_D3GeoMap( svgID, data ){
      function getWindowScale(){
        let s = ww > wh ? wh : ww * 1.1 // contain
        let sr = ww < 700 && ww < wh ? 15 : 12
        return s * sr
      }

      let projection = d3.geo.mercator()
        .center([120.8, 23.8])
        .scale(getWindowScale())
        .translate([ww/2, wh/2])
      
      let path = d3.geo.path().projection( projection )

      d3.select( svgID )
        .selectAll('path')
        .data( data.features )
        .enter()
        .append('path')
        .attr('d', path)
        .attr({
          countyId: (d) => d.properties.COUNTYID,
          countyCode: (d) => d.properties.COUNTYCODE,
          countyName: (d) => d.properties.COUNTYNAME,
          townId: (d) => d.properties.TOWNID || null,
          townCode: (d) => d.properties.TOWNCODE || null,
          townName: (d) => d.properties.TOWNNAME || null,
          mainId: (d) => d.properties.TOWNID || d.properties.COUNTYID,
          mainCode: (d) => d.properties.TOWNCODE || d.properties.COUNTYCODE,
          mainName: (d) => d.properties.TOWNNAME || d.properties.COUNTYNAME,
          indexNo: (d,i) => i,
        })
        .attr({
          class: (d) => d.properties.TOWNID ? 'town' : 'county'
        })
        .style({
          fill: (d) => {
            if (d['mp']){
              if ( $('#showSFColor').hasClass('active') ){
                let good = d['mp']['市長施政滿意比例']
                let bad = d['mp']['市長施政不滿意比例']
                return sfColor( good - bad )
              } else {
                let blue = d['mp']['國民黨籍議員好感度比例']
                let green = d['mp']['民進黨籍議員好感度比例']
                return ppColor( green - blue )
              }
              
              // if ( b > g ){
              //   return blueColor(b)
              // } else {
              //   return greenColor(g)
              // }
              
              
            } else {
              return 'rgba(255,255,255,0.5)'
            }
          }
        })
        .on('mouseenter', d => {
          if (onDrag) { return }

          $('#detail-hover').show()
          $('#detail-county').text( d.properties.COUNTYNAME )
          $('#detail-town').text( d.properties.TOWNNAME || '' )
        })
        .on('click', d => {
          if (onDrag) { return } 

        })
    }


    function changeThemeColor(){
      $.each( data.features, (idx,d)=>{
        if (d['mp']){
          let color = 'rgba(255,255,255,0.5)'
          if ( $('#showSFColor').hasClass('active') ){
            let good = d['mp']['市長施政滿意比例']
            let bad = d['mp']['市長施政不滿意比例']
            color = sfColor(good-bad)
          } else {
            let blue = d['mp']['國民黨籍議員好感度比例']
            let green = d['mp']['民進黨籍議員好感度比例']
            if ( blue > green ){
              color = blueColor(blue)
            } else {
              color = greenColor(green)
            }
          }
          

          if ( d.mp['行政區'] === '總和' ){
            $(`path[countyName=${d.mp['縣市']}][mainName=${d.mp['縣市']}]`).css('fill', color)
          } else {
            $(`path[countyName=${d.mp['縣市']}][mainName=${d.mp['行政區']}]`).css('fill', color)
          }
        }
      })
    }


    // listeners
    $(window).on('resize', ()=>{
      ww = window.innerWidth
      wh = window.innerHeight

      location.reload()
    })

    $('#svgBox').on('mousewheel',() => {
      event.deltaY < 0 ? zoomMap( scaleValue*scaleAmp ) : zoomMap( scaleValue/scaleAmp )
    })

    $('#zoomIn').on('click',() => {
      zoomMap( scaleValue*scaleAmp )
    })

    $('#zoomOut').on('click',() => {
      zoomMap( scaleValue/scaleAmp )
    })


    $('#svg').on('click', function(event){
      if (onDrag) { return }
      
      let $TG = $(event.target)
      if ( $TG[0].nodeName === 'path' ){
        let indexNo = $TG.attr('indexNo')
        if ( $TG.hasClass('county') ){
          $('#svg').find('.county.active').removeClass('active')
          $('#svg').find('.town.active').removeClass('active')
        } else {
          $('#svg').find('.town.active').removeClass('active')
        }
    
        let rect = $TG[0].getBoundingClientRect()
        let xs = ww / rect.width
        let ys = wh / rect.height
        
        let s = xs > ys ? ys : xs
        s = $TG.hasClass('county') ? s * 0.6 : s * 0.3
        console.log(rect, '放大:' + s)
    
        zoomMap( scaleValue * s, $TG[0].getBBox() )
    
        $TG.addClass('active')


        $('#detail-click').show()
        $('#detail-chart1').html('')
        $('#detail-chart2').html('')
        $('#detail-chart3').html('')
        $('#detail-chart4').html('')

        let mp = data.features[indexNo]['mp']
        if ( mp ){
          console.log( mp )
          $('#detail-charts').show()
          $('#detail-mp').html('')

          let chart1 = new ApexCharts( $("#detail-chart1")[0], {
            xaxis: {
              categories: [mp['第一名議員'],mp['第二名議員'],mp['第三名議員']],
              labels: {
                formatter: function (val) {
                  return val + "%"
                }
              }
            },
            series: [{
              name: '',
              data: [mp['第一名議員好感度'],mp['第二名議員好感度'],mp['第三名議員好感度']]
            }],
            dataLabels: {
              formatter: function (val, opt) {
                return val + '%'
              },
            },
            chart: {
              type: 'bar',
              height: 150,
              // width: 360,
              toolbar: {
                show: false,
              }
            },
            tooltip: {
              y: {
                formatter: function (val) {
                  return val + "%"
                }
              }
            },
            plotOptions: {
              bar: {
                horizontal: true,
              }
            },
            tooltip: {
              enabled: false,
            },
          })
          chart1.render()


          let chart2 = new ApexCharts( $("#detail-chart2")[0], {
            series: [
              { name: '國民黨', data: [mp['國民黨籍議員好感度比例']] },
              { name: '民進黨', data: [mp['民進黨籍議員好感度比例']] },
              { name: '其他(無黨籍、其他政黨、未表態)', data: [mp['其他黨籍議員好感度比例']] },
            ],
            colors: ['#05A5F5','#6BDA45','#929292'],
            chart: {
              type: 'bar',
              stacked: true,
              stackType: '100%',
              // width: 360,
              height: 110,
              toolbar: {
                show: false,
              }
            },
            plotOptions: {
              bar: {
                horizontal: true,
              },
            },
            xaxis: {
              categories: [''],
              labels: {
                show: false
              },
            },
            yaxis: {
              labels: {
                show: false
              },
            },
            legend: {
              position: 'top',
              horizontalAlign: 'left',
              offsetX: -8,
              offsetY: 15
            },
            tooltip: {
              enabled: false,
            },
          })
          chart2.render()


          let chart3 = new ApexCharts( $("#detail-chart3")[0], {
            series: [
              { name: '滿意', data: [mp['市長施政滿意比例']] },
              { name: '不滿意', data: [mp['市長施政不滿意比例']] },
              { name: '無意見', data: [mp['市長施政無意見比例']] },
            ],
            colors: ['#00EE00','#FF0000','#929292'],
            chart: {
              type: 'bar',
              stacked: true,
              stackType: '100%',
              // width: 360,
              height: 110,
              toolbar: {
                show: false,
              }
            },
            plotOptions: {
              bar: {
                horizontal: true,
              },
            },
            xaxis: {
              categories: [''],
              labels: {
                show: false
              },
            },
            yaxis: {
              labels: {
                show: false
              },
            },
            legend: {
              position: 'top',
              horizontalAlign: 'left',
              offsetX: -8,
              offsetY: 15
            },
            tooltip: {
              enabled: false,
            },
          })
          chart3.render()


          let chart4 = new ApexCharts( $("#detail-chart4")[0], {
            labels: ['國民黨','民進黨','民眾黨','時代力量','基進黨','中間選民','其他政黨'],
            series: [mp['政黨比例-國民黨'],mp['政黨比例-民進黨'],mp['政黨比例-民眾黨'],mp['政黨比例-時代力量'],mp['政黨比例-基進黨'],mp['政黨比例-中間選民'],mp['政黨比例-其他政黨']],
            colors: ['#05A5F5','#6BDA45','#F9B927','#D30877','#FC0B19','#929292','#28B2F4'],
            chart: {
              type: 'pie',
              // width: 360,
              height: 240,
              toolbar: {
                show: false,
              }
            },
            legend: {
              offsetY: -10
            },
            responsive: [{
              breakpoint: 480,
              options: {
                chart: {
                  // width: 320
                },
                legend: {
                  offsetY: 0,
                  position: 'top'
                }
              }
            }]
          })
          chart4.render()
        } else {
          $('#detail-charts').hide()
          $('#detail-mp').text(`無資料`)
        }






      } else {
        $('#detail-charts').hide()
      }
    })


    function zoomMap( newScale, pathXY ){
      if (onZoom){ return }
      onZoom = true

      let trans = getXYS( $('#svgBox')[0] )
      let oS = scaleValue
      let nS = newScale
      let cW = $('#detail-click').width()

      nS = nS > 20 ? 20 : nS
      nS = nS < 1 ? 1 : nS

      // 邊界 ( 因為scale 是由中心放大，故/2 => 例如1000寬*2=>2000，左右各+500寬 => 邊界從左右 [0,0] => [500,-500] )
      let bx = (ww*nS - ww) / 2
      let by = (wh*nS - wh) / 2

      let x = trans.x * nS / oS
      let y = trans.y * nS / oS

      if ( pathXY ){
        let px = pathXY.x + ( pathXY.width / 2 )
        let py = pathXY.y + ( pathXY.height / 2 )

        x = (ww/2 - px) * nS
        y = (wh/2 - py) * nS

        x -= cW / 2
      } else if ( event.deltaY ){
        x = (ww/2 - event.offsetX) * nS + (event.clientX - ww/2)
        y = (wh/2 - event.offsetY) * nS + (event.clientY - wh/2)
      }

      x = ( x > bx ) ? bx : x
      x = ( x < -bx ) ? -bx : x
      y = ( y > by ) ? by : y
      y = ( y < -by ) ? -by : y

      gsap.fromTo('#svgBox', 0.4, { x: trans.x, y: trans.y, scale: oS }, { x: x, y: y, scale: nS, ease: 'power2.out', 
        onComplete: ()=>{ onZoom = false }
      })
      // $('#svgBox').css('transition', 'transform 0.5s')
      // $('#svgBox').css('transform', `translate(${x}px,${y}px) scale(${nS})`)
      
      nS > 1 ? $('#backLv').show() : $('#backLv').hide()
      scaleValue = nS
    }

    $('#backLv').on('click', function(){
      if (onZoom){ return }
      let $Town = $('#svg').find('.town.active')
      let $County = $('#svg').find('.county.active')

      if ( $Town.length > 0 ){
        let cId = $Town.attr('countyId')
        $Town.removeClass('active')
        $(`[mainId=${cId}]`).click()
      } else if ( $County.length > 0 && $Town.length === 0 ){
        $('#svg').click()
        $('#backLv').hide()
        $County.removeClass('active')
        zoomMap(1)
      } else {
        zoomMap(1)
      }
    })

    $('#svg').on('mouseenter', 'path', function(evt){
      $('#detail-hover').show()
    })
    $('#svg').on('mousemove', 'path', function(evt){
      $('#detail-hover').css({left: evt.clientX + 10 +'px', top: evt.clientY + 15 +'px'})
    })
    $('#svg').on('mouseleave', 'path', function(evt){
      $('#detail-hover').hide()
    })


  </script>
</body>
</html>